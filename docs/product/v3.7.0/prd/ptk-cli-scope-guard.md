# PRD: PTK v3.7.0 - CLI ç»Ÿä¸€å…¥å£ + Scope Guard + åŒæ¨¡å¼æŠ¥å‘Š

**çŠ¶æ€**: Ready
**ç›®æ ‡ç‰ˆæœ¬**: v3.7.0
**æ—¥æœŸ**: 2026-02-28

---

## 0. æœ€ä½³å®è·µå‚è€ƒ

æœ¬ç‰ˆæœ¬å¼€å‘éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š

| æœ€ä½³å®è·µæ¥æº | é€‚ç”¨èŒƒå›´ | åº”ç”¨ç‚¹ |
|-------------|---------|--------|
| `skills-best-practices/README.md` | Skill ç»“æ„ä¸æ¸è¿›æŠ«éœ² | SKILL.md < 500 è¡Œï¼Œå­ç›®å½•ä¸€å±‚æ·±åº¦ |
| `skills/skills/skill-creator/SKILL.md` | Skill åˆ›å»ºä¸è¯„ä¼° | æµ‹è¯•ç”¨ä¾‹ã€evalsã€æè¿°ä¼˜åŒ– |

### Skill å¼€å‘è§„èŒƒï¼ˆv3.7.0 å¼ºåˆ¶ï¼‰

```text
skill-name/
â”œâ”€â”€ SKILL.md              # Required: Metadata + core instructions (<500 lines)
â”œâ”€â”€ scripts/              # Executable code (Python/Bash) designed as tiny CLIs
â”œâ”€â”€ references/           # Supplementary context (schemas, cheatsheets)
â””â”€â”€ assets/               # Templates or static files used in output
```

- **SKILL.md**ï¼šä½œä¸º"å¤§è„‘"ï¼Œç”¨äºå¯¼èˆªå’Œä¸»è¦æµç¨‹
- **References**ï¼šä» SKILL.md é“¾æ¥ï¼Œä¿æŒ**ä¸€å±‚æ·±åº¦**
- **Scripts**ï¼šç”¨äºè„†å¼±/é‡å¤æ“ä½œï¼Œ**ä¸æ‰“åŒ…åº“ä»£ç **
- **æ¸è¿›æŠ«éœ²**ï¼šSKILL.md < 500 è¡Œï¼Œè¯¦ç»†å†…å®¹ç§»è‡³ references/

---

## 1. èƒŒæ™¯

v3.6.0 å·²å®ç°"è¯æ®é©±åŠ¨å·¥ä½œæµ"ï¼ˆworkflow äº§ç‰©é©±åŠ¨ + è¯æ®é—­ç¯ï¼‰ï¼Œä½†ä»å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **CLI å…¥å£ç¢ç‰‡åŒ–**ï¼šè„šæœ¬åˆ†æ•£ï¼ˆteam_runtime.shã€ralph_bridge.shã€review_gate.sh ç­‰ï¼‰ï¼Œæ— ç»Ÿä¸€å…¥å£
2. **LLM æº¢å‡ºé£é™©**ï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­ LLM å®¹æ˜“äº§å‡ºè¶…å‡ºç”¨æˆ·æ•…äº‹èŒƒå›´çš„åŠŸèƒ½ï¼Œç¼ºä¹çº¦æŸæœºåˆ¶
3. **æŠ¥å‘Šå¯è¯»æ€§**ï¼šç°æœ‰æŠ¥å‘Šï¼ˆsummary.json/summary.mdï¼‰æ··æ‚æœºå™¨è°ƒè¯•ä¿¡æ¯ï¼Œä¸é€‚åˆäººç±»å¿«é€Ÿé˜…è¯»
4. **è®°å¿†ä½“åˆ†æ•£**ï¼šproject/session/failure åˆ†å±‚ä¸å®Œæ•´ï¼Œscope åå·®æ— ä¸“é—¨è®°å½•

v3.7.0 ç›®æ ‡ï¼šåœ¨ä¿æŒ v3.6.0 è¯æ®é—­ç¯çš„åŸºç¡€ä¸Šï¼Œæ–°å¢ **ç»Ÿä¸€ CLI å…¥å£**ã€**Scope Guard æœºåˆ¶**ã€**åŒæ¨¡å¼æŠ¥å‘Š**ï¼Œå°† PTK å‡çº§ä¸º"å¯è¿ç»´çš„ CLI Skill ç³»ç»Ÿ"ã€‚

---

## 2. äº§å“ç›®æ ‡

1. **ç»Ÿä¸€ CLI å…¥å£**ï¼š`ptk` å‘½ä»¤èšåˆ status/run/debug/report/resume/doctor
2. **Scope Guard**ï¼šä¸¥æ ¼çº¦æŸ LLM ä¸æº¢å‡ºç”¨æˆ·æ•…äº‹èŒƒå›´ï¼Œä¼˜åŒ–å»ºè®®éœ€äººç±»ç¡®è®¤
3. **åŒæ¨¡å¼æŠ¥å‘Š**ï¼šäººç±»å‹å¥½ï¼ˆå±è”½æœºå™¨ä¿¡æ¯ï¼‰+ æœºå™¨å®Œæ•´ï¼ˆJSON å®Œæ•´æ•°æ®ï¼‰
4. **å¼€å‘æ¨¡å¼åˆ‡æ¢**ï¼šnormal/debug/strict/dry-run/replay å¯é…ç½®
5. **è®°å¿†ä½“ç»Ÿä¸€**ï¼šæ–°å¢ scope-memoryï¼Œåˆ†å±‚æ›´æ¸…æ™°

---

## 3. èŒƒå›´å®šä¹‰

### In Scope

- **CLI ç»Ÿä¸€å…¥å£**ï¼š`ptk` å‘½ä»¤ + å‘½ä»¤è¯å…¸ + æ„å›¾è·¯ç”±
- **Scope Guard æœºåˆ¶**ï¼šAC è§£æã€èŒƒå›´ç›‘æ§ã€äººç±»ç¡®è®¤æµç¨‹
- **åŒæ¨¡å¼æŠ¥å‘Š**ï¼š`--human`ï¼ˆäººç±»å‹å¥½ï¼‰+ `--machine`ï¼ˆæœºå™¨å®Œæ•´ï¼‰
- **å¼€å‘æ¨¡å¼**ï¼š`--mode normal|debug|strict|dry-run|replay`
- **è®°å¿†ä½“å¢å¼º**ï¼šscope-memoryï¼ˆèŒƒå›´åå·®è®°å½•ï¼‰
- **å¯æµ‹æ€§**ï¼šScope Guard æµ‹è¯• + E2E æµ‹è¯•

### Out of Scope

- é‡å†™ OMC/OMX æ‰§è¡Œå¼•æ“
- è·¨å¹³å° converter/syncï¼ˆv3.8+ï¼‰
- è§†é¢‘çº§ session replay
- pass@k å…¨é“¾è·¯è¯„ä¼°ä½“ç³»

---

## 4. åŠŸèƒ½éœ€æ±‚ï¼ˆFRï¼‰

> **æœ€ä½³å®è·µ**ï¼šåŠŸèƒ½å®ç°éµå¾ª skill-creator çš„éªŒè¯æµç¨‹
> - æ¯ä¸ª FR éœ€è¦å¯¹åº”æµ‹è¯•ç”¨ä¾‹ï¼ˆä¿å­˜è‡³ `evals/evals.json`ï¼‰
> - SKILL.md æè¿°ä¼˜åŒ–ä½¿ç”¨æè¿°ä¼˜åŒ–å™¨ï¼ˆtrigger evalï¼‰

### FR-3701ï¼šç»Ÿä¸€ CLI å…¥å£

`ptk` å‘½ä»¤èšåˆä»¥ä¸‹èƒ½åŠ›ï¼š

| å­å‘½ä»¤ | è¯´æ˜ |
|--------|------|
| `ptk status` | èšåˆ team/gate/bridge/test çŠ¶æ€ |
| `ptk run <workflow>` | å°è£…ç°æœ‰ workflow/team/auto-test å…¥å£ |
| `ptk debug watch [run_id]` | å®æ—¶æŸ¥çœ‹å¼‚å¸¸/é˜¶æ®µæµè½¬ |
| `ptk report --human [run_id]` | è¾“å‡ºäººç±»å‹å¥½çœ‹æ¿ |
| `ptk report --machine [run_id]` | è¾“å‡ºæœºå™¨å®Œæ•´æŠ¥å‘Š |
| `ptk feedback sync [run_id]` | å°†å¼‚å¸¸å›å†™ requirement-feedback |
| `ptk resume <run_id>` | é•¿ä»»åŠ¡æ–­ç‚¹æ¢å¤ |
| `ptk doctor` | ç¯å¢ƒã€çŠ¶æ€ã€schema è¯Šæ–­ |

### FR-3702ï¼šScope Guard - AC è§£æä¸ç»‘å®š

- è¾“å…¥ï¼š`docs/product/{version}/user-story/{feature}.md`
- è¾“å‡ºï¼š`ac_scope.json`ï¼ˆAC åˆ—è¡¨ + èŒƒå›´æ ‡è®°ï¼‰

```json
{
  "feature": "ç”µå•†æ”¶è—åŠŸèƒ½",
  "version": "v1.0.0",
  "acceptance_criteria": [
    {"id": "AC1", "scope": "core", "description": "ç”¨æˆ·å¯ä»¥å°†å•†å“æ·»åŠ åˆ°æ”¶è—å¤¹"},
    {"id": "AC2", "scope": "core", "description": "ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ”¶è—å¤¹ä¸­çš„å•†å“åˆ—è¡¨"},
    {"id": "AC3", "scope": "enhancement", "description": "æ”¶è—å¤¹æ”¯æŒæ’åºåŠŸèƒ½"}
  ],
  "core_scope": ["AC1", "AC2"],
  "enhancement_scope": ["AC3"]
}
```

### FR-3703ï¼šScope Guard - èŒƒå›´ç›‘æ§

| æ£€æµ‹ç±»å‹ | å¤„ç†æ–¹å¼ | è¾“å‡º |
|----------|----------|------|
| æ–°åŠŸèƒ½åœ¨ AC èŒƒå›´å†… | æ­£å¸¸å®ç° | æ­£å¸¸äº‹ä»¶æµ |
| æ–°åŠŸèƒ½è¶…å‡º ACï¼ˆä½é£é™©ï¼‰ | è‡ªåŠ¨å®ç° + æ ‡è®° `enhancement-proposal` | å†™å…¥ summary.md |
| æ–°åŠŸèƒ½è¶…å‡º ACï¼ˆé«˜é£é™©ï¼‰ | æš‚åœå®ç° + æ ‡è®° `out-of-scope` | è§¦å‘äººç±»ç¡®è®¤ |

### FR-3704ï¼šScope Guard - äººç±»ç¡®è®¤æµç¨‹

å½“æ£€æµ‹åˆ°é«˜é£é™©æº¢å‡ºæˆ–ä¼˜åŒ–å»ºè®®æ—¶ï¼Œè¾“å‡ºï¼š

```markdown
## äººç±»å†³ç­–åŒºï¼ˆéœ€ç¡®è®¤ï¼‰

### ä¼˜åŒ–å»ºè®®ï¼ˆå»ºè®®è¡¥å……æ–°ç”¨æˆ·æ•…äº‹ï¼Ÿï¼‰
- [ ] å»ºè®®1ï¼šxxxï¼ˆå½±å“èŒƒå›´ï¼šä½/ä¸­/é«˜ï¼‰

### è¶…èŒƒå›´åŠŸèƒ½ï¼ˆæ˜¯å¦ä¿ç•™ï¼Ÿï¼‰
- âš ï¸ åŠŸèƒ½Aï¼šè¶…å‡ºç”¨æˆ·æ•…äº‹èŒƒå›´ï¼Œæ˜¯å¦ä¿ç•™ï¼Ÿ
  - [A] ä¿ç•™å¹¶è¡¥å……ç”¨æˆ·æ•…äº‹ / [B] ä¿ç•™ä¸è¡¥å…… / [C] æ’¤é”€
```

### FR-3705ï¼šåŒæ¨¡å¼æŠ¥å‘Š - äººç±»å‹å¥½

`summary.md` æ ¼å¼è¦æ±‚ï¼š
- å±è”½æœºå™¨ä¿¡æ¯ï¼ˆLLM promptsã€token usageã€tool callsï¼‰
- åªå±•ç¤ºï¼šæ‰§è¡Œç»“æœã€äº§ç‰©æ¸…å•ã€å¾…ç¡®è®¤äº‹é¡¹
- æ”¯æŒ `--human` å‚æ•°

### FR-3706ï¼šåŒæ¨¡å¼æŠ¥å‘Š - æœºå™¨å®Œæ•´

`summary.json` æ ¼å¼è¦æ±‚ï¼š
- ä¿ç•™æ‰€æœ‰äº‹ä»¶æµã€è°ƒè¯•ä¿¡æ¯ã€å®Œæ•´æ•°æ®ç»“æ„
- æ”¯æŒ `--machine` å‚æ•°
- åŒ…å«ï¼ševentsã€llm_promptsã€token_usageã€tool_calls

### FR-3707ï¼šå¼€å‘æ¨¡å¼åˆ‡æ¢

```bash
ptk run workflow --mode normal    # é»˜è®¤ï¼šæ ‡å‡†æ‰§è¡Œ
ptk run workflow --mode debug    # äº‹ä»¶çº§æ—¥å¿—
ptk run workflow --mode strict    # å¼ºé—¨ç¦ + Scope Guard
ptk run workflow --mode dry-run   # åªè·‘è®¡åˆ’ä¸æ ¡éªŒ
ptk run workflow --mode replay    # å†å²å›æ”¾è¯Šæ–­
```

### FR-3708ï¼šè®°å¿†ä½“å¢å¼º

æ–°å¢ `scope-memory`ï¼š

```text
.ptk/memory/
  scope/
    deviations.json      # èŒƒå›´åå·®è®°å½•
    confirmations.json   # äººç±»ç¡®è®¤çŠ¶æ€
```

### FR-3709ï¼šLLM é¢„æµ‹ä¸‹ä¸€æ­¥å¤šé€‰æœºåˆ¶ï¼ˆå…¨å±€å¼ºåŒ–ï¼‰

**ç›®æ ‡**ï¼šæ‰€æœ‰ PTK skill ä½¿ç”¨æ—¶ï¼ŒLLM å¿…é¡»é¢„æµ‹ä¸‹ä¸€æ­¥å¯èƒ½æ“ä½œå¹¶æä¾›å¤šé€‰é€‰é¡¹ï¼Œè®©äººæœºäº¤äº’æ›´å¼ºå¤§ã€‚

**è§¦å‘åœºæ™¯**ï¼š
- æ¯ä¸ª skill æ‰§è¡Œå®Œæˆå
- æ¯ä¸ªå…³é”®é˜¶æ®µå®Œæˆå
- æ£€æµ‹åˆ°ç”¨æˆ·æ„å›¾æ¨¡ç³Šæ—¶

**è¾“å‡ºæ ¼å¼**ï¼š
```markdown
## ğŸ‘† ä¸‹ä¸€æ­¥å»ºè®®ï¼ˆLLM é¢„æµ‹ï¼‰

åŸºäºå½“å‰çŠ¶æ€ï¼Œæ¨èä»¥ä¸‹æ“ä½œï¼š

[A] ç»§ç»­ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼ˆæ¨èï¼‰
[B] å…ˆæ‰§è¡Œ gate æ£€æŸ¥
[C] è°ƒæ•´ç”¨æˆ·æ•…äº‹èŒƒå›´
[D] ç›´æ¥è¿›å…¥å®ç°é˜¶æ®µ

è¯·é€‰æ‹© [A/B/C/D] æˆ–è¾“å…¥å…¶ä»–æŒ‡ä»¤
```

**å¤šé€‰åŸåˆ™**ï¼š
1. è‡³å°‘æä¾› 2-3 ä¸ªé€‰é¡¹
2. æ ‡æ³¨æ¨èé€‰é¡¹ï¼ˆ"æ¨è"æ ‡ç­¾ï¼‰
3. æœ€åä¸€ä¸ªé€‰é¡¹æ°¸è¿œæ˜¯"å…¶ä»–"ï¼ˆå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼‰
4. é€‰é¡¹æŒ‰ç›¸å…³æ€§æ’åº

**ç¤ºä¾‹åœºæ™¯**ï¼š

| å½“å‰é˜¶æ®µ | æ¨èé€‰é¡¹ |
|----------|----------|
| think å®Œæˆå | [A] ç”Ÿæˆç”¨æˆ·æ•…äº‹ / [B] è¡¥å……æ›´å¤šé—®é¢˜ / [C] ç›´æ¥è¿›å…¥ PRD |
| user-story å®Œæˆå | [A] ç”Ÿæˆ PRD / [B] è°ƒæ•´æ•…äº‹èŒƒå›´ / [C] ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ |
| test-case å®Œæˆå | [A] æ‰§è¡Œ gate æ£€æŸ¥ / [B] è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯• / [C] ç›´æ¥è¿›å…¥å®ç° |
| gate Blocked å | [A] æŸ¥çœ‹é˜»å¡åŸå›  / [B] è°ƒæ•´éœ€æ±‚ / [C] ç”³è¯·äººå·¥å®¡æ‰¹ |
| gate Pass å | [A] è¿›å…¥å®ç°é˜¶æ®µ / [B] ç”Ÿæˆå‘å¸ƒæ¸…å• / [C] ç»“æŸæµç¨‹ |

### FR-3710ï¼šPTK å·¥ä½œç”Ÿå‘½å‘¨æœŸä¸ç‰ˆæœ¬è¿­ä»£

**å·¥ä½œç”Ÿå‘½å‘¨æœŸ**ï¼š
```
ç”¨æˆ·éœ€æ±‚ â†’ think â†’ version â†’ user-story â†’ prd â†’ test-case â†’ implementation â†’ gate â†’ release
                                              â†‘                              â†“
                                        ç‰ˆæœ¬è§„åˆ’                      çƒ­ä¿®å¤/è¿­ä»£
```

**ç‰ˆæœ¬è¿­ä»£è§„åˆ™**ï¼š
1. **å¤§ç‰ˆæœ¬**ï¼ˆx.0.0ï¼‰ï¼šLLM åˆ†æåŠŸèƒ½èŒƒå›´ï¼Œæ¨èç‰ˆæœ¬å·ï¼Œäººç±»ç¡®è®¤
2. **å°ç‰ˆæœ¬**ï¼ˆx.y.0ï¼‰ï¼šåŠŸèƒ½å¢é‡ï¼ŒLLM æ¨èï¼Œäººç±»ç¡®è®¤
3. **çƒ­ä¿®å¤**ï¼ˆx.y.zï¼‰ï¼šé—®é¢˜ä¿®å¤ï¼Œè‡ªåŠ¨é€’è¿›

**ç”¨æˆ·ä»‹å…¥ç‚¹**ï¼š
| é˜¶æ®µ | ä»‹å…¥æ—¶æœº | å¯è°ƒæ•´å†…å®¹ |
|------|----------|------------|
| think | æ¯è½®ç»“æŸå | é—®é¢˜å®šä¹‰ã€ä¼˜å…ˆçº§ |
| version | å®Œæˆå | ç‰ˆæœ¬å·ã€èŒƒå›´ |
| user-story | å®Œæˆå | æ•…äº‹èŒƒå›´ã€AC |
| gate | Blocked æ—¶ | éœ€æ±‚ã€éªŒæ”¶æ ‡å‡† |
| release | å®Œæˆå | å‘å¸ƒæ¸…å• |

### FR-3711ï¼šæµ‹è¯•ç”¨ä¾‹æ¡†æ¶ï¼ˆäº’è”ç½‘ QA æ ‡å‡†ï¼‰

**æµ‹è¯•ç±»å‹çŸ©é˜µ**ï¼š

| æµ‹è¯•ç±»å‹ | é€‚ç”¨åœºæ™¯ | å·¥å…· | è¦†ç›–è¦æ±‚ |
|----------|----------|------|----------|
| å•å…ƒæµ‹è¯• | å•ä¸ªå‡½æ•°/æ¨¡å— | pytest/jest | â‰¥ 80% |
| é›†æˆæµ‹è¯• | API/ç»„ä»¶äº¤äº’ | requests/curl | å…³é”®è·¯å¾„ |
| E2Eæµ‹è¯•-å‰ç«¯ | å‰åç«¯é¡¹ç›® | agent-browser | æ ¸å¿ƒæµç¨‹ |
| E2Eæµ‹è¯•-åç«¯ | çº¯åç«¯HTTP | curl/Postman | API è¦†ç›– |
| å›å½’æµ‹è¯• | å…¨é“¾è·¯éªŒè¯ | è‡ªåŠ¨åŒ– E2E | å…¨é‡ |

**æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ**ï¼š
- LLM è‡ªåŠ¨åˆ†ææµ‹è¯•æ–¹æ¡ˆ
- æ ¹æ®é¡¹ç›®ç±»å‹æ¨èæµ‹è¯•ç­–ç•¥
- ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹åéœ€äººç±»ç¡®è®¤

**å‰åç«¯ E2E æµ‹è¯•**ï¼š

```bash
# å‰åç«¯é¡¹ç›®ï¼ˆWebåº”ç”¨ï¼‰
ptk auto-test --type e2e --tool agent-browser
# ä½¿ç”¨ agent-browser è¿›è¡Œ UI è‡ªåŠ¨åŒ–æµ‹è¯•
# è¦†ç›–ï¼šç™»å½•ã€CRUDã€é¡µé¢è·³è½¬ã€çŠ¶æ€éªŒè¯

# çº¯åç«¯é¡¹ç›®ï¼ˆAPIæœåŠ¡ï¼‰
ptk auto-test --type e2e --tool curl
# ä½¿ç”¨ curl è¿›è¡Œ HTTP API æµ‹è¯•
# è¦†ç›–ï¼šRESTful APIã€è®¤è¯ã€æƒé™ã€æ•°æ®éªŒè¯
```

**æµ‹è¯•æŠ¥å‘Š**ï¼š
```json
{
  "test_summary": {
    "total": 50,
    "passed": 45,
    "failed": 3,
    "skipped": 2,
    "coverage": "85%"
  },
  "e2e_results": {
    "frontend": {
      "tool": "agent-browser",
      "scenarios": ["login", "create", "update", "delete"],
      "passed": 10,
      "failed": 1
    },
    "backend": {
      "tool": "curl",
      "endpoints": 15,
      "passed": 14,
      "failed": 1
    }
  }
}
```

### FR-3712ï¼šäº¤ä»˜æ ‡å‡†ä¸è¯æ®é“¾

**ä¸¥æ ¼äº¤ä»˜æ ‡å‡†**ï¼š

| é˜¶æ®µ | å¿…é¡»äº§ç‰© | Gate æ ‡å‡† |
|------|----------|-----------|
| user-story | AC å®Œæ•´ï¼Œæ—  open question | 100% AC è¦†ç›– |
| prd | åŠŸèƒ½æè¿°å®Œæ•´ï¼Œè¾¹ç•Œæ¸…æ™° | æ—  critical å†²çª |
| test-case | TC è¦†ç›–æ‰€æœ‰ AC | â‰¥ 80% è‡ªåŠ¨åŒ– |
| implementation | ä»£ç  + å•å…ƒæµ‹è¯• | æµ‹è¯•é€šè¿‡ |
| gate | è¯æ®é“¾å®Œæ•´ | å…¨éƒ¨ Pass |

**è¯æ®é“¾ç»“æ„**ï¼š
```json
{
  "delivery_package": {
    "version": "v1.0.0",
    "features": ["f1", "f2"],
    "evidence": {
      "ac_tc_mapping": "ac_tc_mapping.json",
      "test_results": "test_results.json",
      "code_coverage": "code_coverage.json",
      "gate_report": "gate_report.json",
      "artifacts": ["screenshots", "logs", "reports"]
    },
    "signatures": {
      "llm_signature": "hash",
      "human_approval": "name@timestamp"
    }
  }
}
```

**Gate åˆ¤å®šè§„åˆ™**ï¼š
1. ä»»ä½• critical é¡¹æœªé€šè¿‡ â†’ Blocked
2. ACâ†’TC æ˜ å°„ç¼ºå¤± â†’ Blocked
3. æµ‹è¯•è¦†ç›–ç‡ < 80% â†’ Warnï¼ˆå¯ç»§ç»­ï¼‰
4. è¯æ®é“¾ä¸å®Œæ•´ â†’ Blocked

### FR-3713ï¼šå…¨é˜¶æ®µè¯æ®é“¾è¦†ç›–ï¼ˆåŸºäºç°æœ‰å®ç°ï¼‰

**ç›®æ ‡**ï¼šè¯æ®é“¾è¦†ç›– think â†’ version â†’ user-story â†’ prd â†’ test-case â†’ implementation â†’ gate å…¨é˜¶æ®µ

**åŸºäºç°æœ‰å®ç°**ï¼š
- `evidence_integrity_common.py`ï¼šé€šç”¨è¯æ®å‡½æ•°ï¼ˆSHA256ã€æ¨¡æ¿æ£€æµ‹ã€æ ¼å¼æ ¡éªŒï¼‰
- `build_evidence_manifest.py`ï¼šè¯æ®æ¸…å•æ„å»º
- `validate_terminal_artifacts.py`ï¼šç»ˆç«¯è¯æ®æ ¡éªŒ

**å„é˜¶æ®µè¯æ®è¦æ±‚**ï¼š

| é˜¶æ®µ | å¿…éœ€è¯æ® | æ ¡éªŒå™¨ |
|------|----------|--------|
| think | å¯¹è¯è®°å½•.jsonã€é—®é¢˜æ¸…å•.json | validate_think_output |
| version | ç‰ˆæœ¬åˆ†æ.mdã€version.json | validate_version_output |
| user-story | user-story.mdã€ac_scope.json | validate_user_story_output |
| prd | prd.mdã€boundaries.md | validate_prd_output |
| test-case | test-cases.mdã€ACæ˜ å°„.json | validate_testcase_output |
| implementation | ä»£ç æ–‡ä»¶ã€å•å…ƒæµ‹è¯•ç»“æœ | validate_implementation_output |
| gate | terminal.jsonã€evidence-manifest.json | ç°æœ‰ validate_terminal_artifacts |

### FR-3714ï¼šLLM ç”Ÿæˆå†…å®¹é˜²ä¼ªæ ¡éªŒ

**ç›®æ ‡**ï¼šæœç» LLM åº”ä»˜å¼ç”Ÿæˆå‡è¯æ®

**åŸºäºç°æœ‰**ï¼š`evidence_integrity_common.py` å·²æœ‰ `_is_template_markdown()` æ¨¡æ¿æ£€æµ‹

**æ–°å¢æ ¡éªŒè§„åˆ™**ï¼š

```python
# å†…å®¹çœŸå®æ€§æ ¡éªŒ
def validate_content_authenticity(content: str, phase: str) -> dict:
    issues = []

    # 1. æ£€æµ‹æ¨¡æ¿å¡«å……ï¼ˆplaceholder æœªæ›¿æ¢ï¼‰
    placeholders = re.findall(r'<[^>]+>', content)
    if len(placeholders) > 3:
        issues.append(f"å‘ç° {len(placeholders)} ä¸ªæœªæ›¿æ¢å ä½ç¬¦")

    # 2. æ£€æµ‹é‡å¤å†…å®¹ï¼ˆCtrl+C/Vï¼‰
    lines = [l for l in content.split('\n') if l.strip()]
    unique_lines = set(lines)
    if len(unique_lines) / max(len(lines), 1) < 0.3:
        issues.append("å†…å®¹é‡å¤ç‡è¿‡é«˜ï¼Œå¯èƒ½æ˜¯å¤åˆ¶ç²˜è´´")

    # 3. æ£€æµ‹é•¿åº¦å¼‚å¸¸
    if len(content) < 200:
        issues.append("å†…å®¹è¿‡çŸ­ï¼Œå¯èƒ½æœªçœŸæ­£åˆ†æ")

    return {"authentic": len(issues) == 0, "issues": issues}
```

**æ ¡éªŒè§¦å‘**ï¼š
- æ¯ä¸ªé˜¶æ®µäº§å‡ºåè‡ªåŠ¨è§¦å‘
- æ£€æµ‹åˆ°é—®é¢˜ â†’ æ ‡è®°ä¸º `suspicious` â†’ è§¦å‘äººç±»ç¡®è®¤

### FR-3715ï¼šLLM è¯æ®è´¨é‡é¢„æµ‹

**ç›®æ ‡**ï¼šLLM é¢„æµ‹è¯æ®è´¨é‡ï¼Œæå‰é¢„è­¦é£é™©

**é¢„æµ‹æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | è¯´æ˜ | è®¡ç®—æ–¹å¼ |
|------|------|----------|
| completeness | å®Œæ•´æ€§ | å·²æœ‰æ–‡ä»¶æ•° / å¿…éœ€æ–‡ä»¶æ•° |
| consistency | ä¸€è‡´æ€§ | è·¨æ–‡ä»¶å†²çªæ£€æµ‹ |
| verifiability | å¯éªŒè¯æ€§ | è¯æ®å¯è¿½æº¯ç¨‹åº¦ |

**è¾“å‡ºæ ¼å¼**ï¼š
```markdown
## è¯æ®è´¨é‡è¯„ä¼°

| æŒ‡æ ‡ | å¾—åˆ† | ç½®ä¿¡åº¦ |
|------|------|--------|
| å®Œæ•´æ€§ | 85% | é«˜ |
| ä¸€è‡´æ€§ | 90% | é«˜ |
| å¯éªŒè¯æ€§ | 70% | ä¸­ |

âš ï¸ é£é™©æç¤ºï¼š
- test-case ä¸­æœ‰ 2 ä¸ª TC æœªæ‰¾åˆ°å¯¹åº” AC
- å»ºè®®è¡¥å……åå†è¿›å…¥ä¸‹ä¸€é˜¶æ®µ

å»ºè®®ï¼š[A] è¡¥å……è¯æ® / [B] ç”³è¯·äººå·¥è±å… / [C] ç»§ç»­ï¼ˆé£é™©è‡ªæ‹…ï¼‰
```

### FR-3716ï¼šæµ‹è¯•è¯æ®æ•´åˆ

**ç›®æ ‡**ï¼šE2E æµ‹è¯•ç»“æœçº³å…¥è¯æ®é“¾

**åŸºäºç°æœ‰**ï¼š`parse_raw_command_log()` å·²æ”¯æŒå‘½ä»¤æ—¥å¿—æ ¡éªŒ

**æ–°å¢æµ‹è¯•è¯æ®**ï¼š

| æµ‹è¯•ç±»å‹ | å¿…éœ€è¯æ® | æ ¡éªŒå™¨ |
|----------|----------|--------|
| å•å…ƒæµ‹è¯• | pytest.xmlã€coverage.json | validate_unit_test |
| E2E-å‰ç«¯ | browser-report.jsonã€screenshots/ | validate_e2e_browser |
| E2E-API | api-report.jsonã€curl-logs/ | validate_e2e_api |

**æ ¡éªŒæµç¨‹**ï¼š
```
LLM ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
    â†“
æ‰§è¡Œæµ‹è¯•ï¼ˆå¤–éƒ¨å·¥å…·ï¼Œé LLM è‡ªå·±ï¼‰
    â†“
æ”¶é›†æµ‹è¯•è¯æ®ï¼ˆæŠ¥å‘Šã€æˆªå›¾ã€æ—¥å¿—ï¼‰
    â†“
æ ¡éªŒè¯æ®çœŸå®æ€§
    â†“
çº³å…¥ evidence_manifest
```

### FR-3717ï¼šç‰ˆæœ¬é“¾è¯æ®è¿½è¸ª

**ç›®æ ‡**ï¼šçƒ­ä¿®å¤ç‰ˆæœ¬é€’è¿›æ—¶æœ‰å®Œæ•´è¯æ®é“¾

**ç‰ˆæœ¬é“¾ç»“æ„**ï¼š
```json
{
  "version_chain": {
    "current": "v1.0.1",
    "parent": "v1.0.0",
    "change_type": "hotfix",
    "changes": [
      {"type": "fix", "description": "ä¿®å¤ç™»å½•é—®é¢˜", "evidence": "commit-xxx"}
    ],
    "diff_evidence": {
      "added_files": [],
      "modified_files": ["docs/product/v1.0.1/..."],
      "deleted_files": []
    }
  }
}
```

**çƒ­ä¿®å¤è§„åˆ™**ï¼š
1. åªéœ€æä¾› fix è¯æ®ï¼Œæ— éœ€å®Œæ•´æµç¨‹
2. è‡ªåŠ¨ç»§æ‰¿çˆ¶ç‰ˆæœ¬è¯æ®
3. æ–°å¢ diff è¯æ®

---

## 5. éåŠŸèƒ½éœ€æ±‚ï¼ˆNFRï¼‰

1. **æ˜“ç”¨æ€§**ï¼šCLI å‚æ•°ç®€æ´ï¼Œhelp ä¿¡æ¯å®Œæ•´
2. **å¯è§‚æµ‹æ€§**ï¼šdebug æ¨¡å¼è¾“å‡ºäº‹ä»¶æµå¯ tail
3. **å¯å®¡è®¡æ€§**ï¼šåŒæ¨¡å¼æŠ¥å‘Šæ»¡è¶³äººç±»/æœºå™¨ä¸åŒåœºæ™¯
4. **å¯æµ‹æ€§**ï¼šScope Guard æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
5. **å‘åå…¼å®¹**ï¼šç°æœ‰è„šæœ¬ä¸ç ´åï¼ŒCLI ä»…åšç¼–æ’
6. **è¯æ®å¯ä¿¡**ï¼šå…¨é˜¶æ®µè¯æ®é“¾ + é˜²ä¼ªæ ¡éªŒ + è´¨é‡é¢„æµ‹
7. **ç‰ˆæœ¬è¿½æº¯**ï¼šç‰ˆæœ¬é“¾å®Œæ•´ï¼Œçƒ­ä¿®å¤å¯é€’è¿›

---

## 6. é‡Œç¨‹ç¢‘

### M0ï¼šScope Guard åŸºç¡€ï¼ˆ1-2 å¤©ï¼‰
- AC è§£ææ¨¡å—
- scope-deviation äº‹ä»¶å®šä¹‰
- äº§ç‰©ï¼š`scripts/scope_guard/ac_parser.py` + `config/scope-guard.yaml`

### M1ï¼šCLI MVPï¼ˆ2-3 å¤©ï¼‰
- `ptk status/run/debug watch/report` å‘½ä»¤
- å‘½ä»¤è¯å…¸åˆç‰ˆ
- äº§ç‰©ï¼š`.ptk/runs/<run_id>/events.jsonl + summary.md + summary.json`

### M2ï¼šå¼€å‘æ¨¡å¼ä¸ä¸¥æ ¼é—¨ç¦ï¼ˆ2-4 å¤©ï¼‰
- `--mode` å…¨é‡æ”¯æŒ
- strict gate + è·¯ç”±ç½®ä¿¡åº¦ç­–ç•¥
- Scope Guard æ‹¦æˆª

### M3ï¼šè®°å¿†ä½“ç»Ÿä¸€ä¸åé¦ˆé—­ç¯ï¼ˆ2-3 å¤©ï¼‰
- ç»Ÿä¸€ memory schema
- scope-memory
- requirement-feedback è”åŠ¨

### M4ï¼šå¯æµ‹æ€§æ”¶å£ï¼ˆ2-3 å¤©ï¼‰
- contract/e2e/replay æµ‹è¯•
- Scope Guard æµ‹è¯•é›†
- `ptk doctor` å®Œå–„

---

## 7. éªŒæ”¶æ ‡å‡†ï¼ˆDoDï¼‰

1. **CLI å¯ç”¨**ï¼š`ptk status/run/debug/report/resume/doctor` å„å‘½ä»¤å¯æ‰§è¡Œ
2. **Scope Guard ç”Ÿæ•ˆ**ï¼šLLM æº¢å‡º AC èŒƒå›´æ—¶è‡ªåŠ¨æ ‡è®° + äººç±»ç¡®è®¤æµç¨‹å¯èµ°é€š
3. **åŒæ¨¡å¼æŠ¥å‘Šå¯ç”¨**ï¼š
   - `ptk report --human` å±è”½æœºå™¨ä¿¡æ¯
   - `ptk report --machine` è¾“å‡ºå®Œæ•´ JSON
4. **å¼€å‘æ¨¡å¼å¯åˆ‡æ¢**ï¼šnormal/debug/strict/dry-run/replay å‡ç”Ÿæ•ˆ
5. **LLM é¢„æµ‹ä¸‹ä¸€æ­¥**ï¼šæ¯ä¸ª skill/é˜¶æ®µå®Œæˆåè¾“å‡ºå¤šé€‰å»ºè®®
6. **å·¥ä½œç”Ÿå‘½å‘¨æœŸå®Œæ•´**ï¼šthinkâ†’versionâ†’user-storyâ†’prdâ†’test-caseâ†’gateâ†’release å¯æµè½¬
7. **ç‰ˆæœ¬è¿­ä»£**ï¼šå¤§ç‰ˆæœ¬äººç±»ç¡®è®¤ï¼Œå°ç‰ˆæœ¬æ¨èç¡®è®¤ï¼Œçƒ­ä¿®å¤è‡ªåŠ¨é€’è¿›
8. **æµ‹è¯•æ¡†æ¶å®Œæ•´**ï¼š
   - å•å…ƒæµ‹è¯• â‰¥ 80% è¦†ç›–ç‡
   - E2E æµ‹è¯•ï¼ˆå‰ç«¯ agent-browserï¼Œåç«¯ curlï¼‰
   - æµ‹è¯•æŠ¥å‘Šç»“æ„åŒ–
9. **äº¤ä»˜æ ‡å‡†ä¸¥æ ¼**ï¼šè¯æ®é“¾å®Œæ•´ï¼ŒGate åˆ¤å®šè§„åˆ™æ˜ç¡®
10. **å…¨é˜¶æ®µè¯æ®é“¾**ï¼šthinkâ†’versionâ†’user-storyâ†’prdâ†’test-caseâ†’gate å‡æœ‰è¯æ®é”šç‚¹
11. **è¯æ®é˜²ä¼ªæ ¡éªŒ**ï¼šå†…å®¹çœŸå®æ€§æ£€æµ‹ï¼ˆå ä½ç¬¦ã€é‡å¤ç‡ã€é•¿åº¦ï¼‰
12. **è¯æ®è´¨é‡é¢„æµ‹**ï¼šLLM é¢„æµ‹è´¨é‡å¾—åˆ† + é£é™©æç¤º
13. **ç‰ˆæœ¬é“¾è¿½æº¯**ï¼šçƒ­ä¿®å¤ç‰ˆæœ¬é€’è¿›ï¼Œè¯æ®é“¾å¯è¿½æº¯

---

## 8. é£é™©ä¸ç¼“è§£

1. **é£é™©**ï¼šScope Guard å¢åŠ æ‰§è¡Œå¤æ‚åº¦ï¼Œå¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒ
   **ç¼“è§£**ï¼šstrict æ¨¡å¼å¯é€‰ï¼Œé»˜è®¤ normal æ¨¡å¼ä¸å¯ç”¨

2. **é£é™©**ï¼šåŒæ¨¡å¼æŠ¥å‘Šå¢åŠ ç»´æŠ¤æˆæœ¬
   **ç¼“è§£**ï¼šé€šè¿‡æ¨¡æ¿å¤ç”¨ï¼Œä»£ç å…±äº«

3. **é£é™©**ï¼šCLI å¼•å…¥æ–°å­¦ä¹ æˆæœ¬
   **ç¼“è§£**ï¼šä¿ç•™ç°æœ‰è„šæœ¬å…¼å®¹ï¼Œæ¸è¿›è¿ç§»

---

## 9. äº¤å‰å¼•ç”¨

- ç”¨æˆ·æ•…äº‹ï¼š`docs/product/v3.7.0/user-story/ptk-cli-scope-guard.md`
- æµ‹è¯•ç”¨ä¾‹ï¼š`docs/product/v3.7.0/qa/test-cases/ptk-cli-scope-guard.md`
- æ‰§è¡Œè¾¹ç•Œï¼š`docs/product/v3.7.0/execution/boundaries.md`
- ç»ˆæ€æ¨¡æ¿ï¼š`docs/product/v3.7.0/execution/terminal.json`
- OMC/OMX ä¸‹ä¸€æ­¥æ¨¡æ¿ï¼š`docs/product/v3.7.0/execution/next-step-prompts.md`
- æ¶æ„è®¾è®¡ï¼š`docs/product/v3.7.0/architecture/README.md`
- è§„åˆ’æ–‡æ¡£ï¼š`docs/plans/2026-02-28-ptk-cli-debug-reference-synthesis-v3.7.0.md`

---

## 10. workflow æœ€å°äº¤ä»˜æ¸…å•ï¼ˆv3.7.0ï¼‰

| ç±»åˆ« | å¿…é¡»äº§ç‰© | è·¯å¾„ |
|------|----------|------|
| éœ€æ±‚ | ç”¨æˆ·æ•…äº‹ | `docs/product/v3.7.0/user-story/ptk-cli-scope-guard.md` |
| éœ€æ±‚ | PRD | `docs/product/v3.7.0/prd/ptk-cli-scope-guard.md` |
| æµ‹è¯• | æµ‹è¯•ç”¨ä¾‹ + ACâ†’TC çŸ©é˜µ | `docs/product/v3.7.0/qa/test-cases/ptk-cli-scope-guard.md` |
| æ‰§è¡Œ | Boundaries | `docs/product/v3.7.0/execution/boundaries.md` |
| æ‰§è¡Œ | Terminal | `docs/product/v3.7.0/execution/terminal.json` |
| æ‰§è¡Œ | å›ºå®šæç¤ºè¯æ¨¡æ¿ | `docs/product/v3.7.0/execution/next-step-prompts.md` |
| æ¶æ„ | System Context | `docs/product/v3.7.0/architecture/system-context.md` |
| æ¶æ„ | Responsibility Boundaries | `docs/product/v3.7.0/architecture/responsibility-boundaries.md` |
| æ¶æ„ | API Contracts | `docs/product/v3.7.0/architecture/api-contracts.md` |
| æ¶æ„ | NFR Budgets | `docs/product/v3.7.0/architecture/nfr-budgets.md` |
| æ¶æ„ | ADR Index | `docs/product/v3.7.0/architecture/adr-index.md` |

---

## 11. FR â†’ US â†’ TC è¿½æº¯çŸ©é˜µï¼ˆæ‘˜è¦ï¼‰

| FR | å¯¹åº” US | ä¸»è¦†ç›– TCï¼ˆè®¡åˆ’ï¼‰ |
|----|---------|------------------|
| FR-3701 CLI ç»Ÿä¸€å…¥å£ | US-3701 | TC-3701/TC-3702 |
| FR-3702 AC è§£æç»‘å®š | US-3702 | TC-3703 |
| FR-3703 èŒƒå›´ç›‘æ§ | US-3703 | TC-3704 |
| FR-3704 äººç±»ç¡®è®¤æµç¨‹ | US-3704 | TC-3705 |
| FR-3705 äººç±»å‹å¥½æŠ¥å‘Š | US-3705 | TC-3706 |
| FR-3706 æœºå™¨å®Œæ•´æŠ¥å‘Š | US-3706 | TC-3707 |
| FR-3707 å¼€å‘æ¨¡å¼åˆ‡æ¢ | US-3707 | TC-3708 |
| FR-3708 scope-memory | US-3708 | TC-3709 |
| FR-3709 ä¸‹ä¸€æ­¥å¤šé€‰ | US-3701/US-3709 | TC-3710 |
| FR-3710 ç”Ÿå‘½å‘¨æœŸä¸ç‰ˆæœ¬è¿­ä»£ | US-3701/US-3707 | TC-3711 |
| FR-3711 æµ‹è¯•æ¡†æ¶ | US-3706/US-3710 | TC-3712 |
| FR-3712 äº¤ä»˜æ ‡å‡†ä¸è¯æ®é“¾ | US-3705/US-3706 | TC-3713 |
| FR-3713 å…¨é˜¶æ®µè¯æ®é“¾è¦†ç›– | US-3710 | TC-3714 |
| FR-3714 é˜²ä¼ªæ ¡éªŒ | US-3710 | TC-3715 |
| FR-3715 è¯æ®è´¨é‡é¢„æµ‹ | US-3710 | TC-3716 |
| FR-3716 æµ‹è¯•è¯æ®æ•´åˆ | US-3706/US-3710 | TC-3717 |
| FR-3717 ç‰ˆæœ¬é“¾è¯æ®è¿½è¸ª | US-3707 | TC-3718 |

---

## 12. Open Questions Ledgerï¼ˆéé˜»å¡ï¼‰

| id | question | reason | source_round | priority | blocking | owner | close_criteria | status |
|----|----------|--------|--------------|----------|----------|-------|----------------|--------|
| OQ-3701 | Scope Guard è‡ªåŠ¨æ‰¹å‡†é˜ˆå€¼æ˜¯å¦å¼€æ”¾é…ç½®ï¼Ÿ | strict ä¸æ˜“ç”¨æ€§å¹³è¡¡ | r2 | P1 | false | PM + Tech Lead | æ˜ç¡®é»˜è®¤é˜ˆå€¼ä¸å¯é…ç½®é¡¹ | open |
| OQ-3702 | æ„å›¾è·¯ç”±æ˜¯å¦ä¾èµ–ç¦»çº¿æ¨¡å‹ï¼Ÿ | æˆæœ¬ä¸ä½“éªŒæƒè¡¡ | r2 | P2 | false | Tech Lead | æ˜ç¡®åœ¨çº¿/ç¦»çº¿è·¯ç”±ç­–ç•¥ | open |
| OQ-3703 | `ptk report --human` çš„é»˜è®¤è„±æ•ç­‰çº§ | åˆè§„è¦æ±‚å·®å¼‚ | r3 | P1 | false | QA + Security | è¾“å‡ºè„±æ•ç­–ç•¥å¹¶é€šè¿‡è¯„å®¡ | open |

> å½“å‰æ—  `blocking=true` æœªå†³é¡¹ï¼Œæœ¬ PRD å¯è¿›å…¥å®ç°é˜¶æ®µã€‚
